{{> layout/header}}

<main class="container py-4">
    {{#lawyer}}
        <div class="row g-4 align-items-start">

            <!-- 왼쪽 프로필 영역 -->
            <div class="col-md-3 text-center">
                {{#profileImageUrl}}
                    <img src="{{profileImageUrl}}" alt="{{user.username}} 프로필" class="img-fluid rounded-3 shadow-sm mb-3">
                {{/profileImageUrl}}
                {{^profileImageUrl}}
                    <img src="/images/default-profile.png" alt="기본 프로필" class="img-fluid rounded-3 shadow-sm mb-3">
                {{/profileImageUrl}}

                {{#canEdit}}
                    <form method="post" action="/view/lawyers/{{id}}/photo" enctype="multipart/form-data">
                        {{#_csrf}}
                            <input type="hidden" name="{{parameterName}}" value="{{token}}">
                        {{/_csrf}}
                        <input id="profileImageInput" class="form-control form-control-sm mb-2" type="file" name="profileImage" accept="image/*">
                        <button class="btn btn-sm btn-primary w-100" type="submit">프로필 사진 업로드</button>
                    </form>
                {{/canEdit}}
            </div>

            <!-- 오른쪽 상세 정보 영역 -->
            <div class="col-md-9">
                <h2 class="mb-1">
                    {{user.username}}
                    {{#title}}<small class="text-muted fs-6 ms-2">{{title}}</small>{{/title}}
                </h2>

                {{#office}}<div class="text-muted mb-2">소속: {{office}}</div>{{/office}}

                {{#approvalStatus}}
                    <span class="badge bg-primary mb-3">{{approvalStatus}}</span>
                {{/approvalStatus}}

                {{#bio}}
                    <div class="mb-3">
                        <h5>자기소개</h5>
                        <p class="lead">{{bio}}</p>
                    </div>
                {{/bio}}

                <dl class="row small">
                    {{#specialty}}
                        <dt class="col-sm-2">전문분야</dt>
                        <dd class="col-sm-10">{{specialty}}</dd>
                    {{/specialty}}
                    {{#career}}
                        <dt class="col-sm-2">경력</dt>
                        <dd class="col-sm-10">{{career}}</dd>
                    {{/career}}
                    {{#contact}}
                        <dt class="col-sm-2">연락처</dt>
                        <dd class="col-sm-10">{{contact}}</dd>
                    {{/contact}}
                </dl>

                {{#canConsult}}
                    <hr class="my-4">
                    <h5>상담하기</h5>
                    <form method="post" action="/view/lawyers/{{id}}/consult">
                        {{#_csrf}}<input type="hidden" name="{{parameterName}}" value="{{token}}">{{/_csrf}}
                        <input type="hidden" name="lawyerId" value="{{id}}">
                        <div class="mb-2">
                            <input type="text" name="title" class="form-control" placeholder="상담 제목" required>
                        </div>
                        <div class="mb-2">
                            <textarea name="content" class="form-control" rows="4" placeholder="상담 내용을 입력하세요" required></textarea>
                        </div>
                        <button class="btn btn-primary">상담 요청</button>
                    </form>
                {{/canConsult}}

                <div class="mt-3">
                    <a href="/view/lawyers" class="btn btn-secondary">목록으로</a>
                    {{#canEdit}}
                        <a href="/view/lawyers/{{id}}/edit" class="btn btn-outline-primary">정보 수정</a>
                    {{/canEdit}}
                </div>
            </div>
        </div>
    {{/lawyer}}

    {{^lawyer}}
        <div class="text-center py-5">
            <h4 class="text-muted">변호사 정보를 찾을 수 없습니다.</h4>
            <a href="/view/lawyers" class="btn btn-primary mt-3">목록으로 돌아가기</a>
        </div>
    {{/lawyer}}
</main>

{{> layout/footer}}

<script>
    const pInput = document.getElementById('profileImageInput');
    if (pInput) {
        pInput.addEventListener('change', (e) => {
            const file = e.target.files?.[0];
            if (!file) return;
            const img = document.querySelector('img[alt$="프로필"]');
            if (img) img.src = URL.createObjectURL(file);
        });
    }
</script>
